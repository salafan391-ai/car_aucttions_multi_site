{% load static tailwind_tags whatsapp_tags %}
<!DOCTYPE html>
<html lang="ar" dir="rtl" id="html-root">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{{ site_name|default:"Ø³ÙŠØ§Ø±Ø§Øª" }}{% endblock %}</title>
    {% if site_favicon %}<link rel="icon" href="{{ site_favicon }}">{% endif %}
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    {% tailwind_css %}
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'tajawal': ['Tajawal', 'sans-serif'],
                    },
                    colors: {
                        dark: { 800: '#1a1a2e', 900: '#0f0f23' },
                    }
                }
            }
        }
    </script>
    <style>
        :root {
            --color-primary: {{ primary_color|default:'#2563eb' }};
            --color-secondary: {{ secondary_color|default:'#1e3a8a' }};
            --color-accent: {{ accent_color|default:'#3b82f6' }};
        }
        body { font-family: 'Tajawal', sans-serif; }
        html[lang="en"] body, html[lang="ko"] body { font-family: 'Inter', 'Tajawal', sans-serif; }
        .car-card:hover { transform: translateY(-4px); }
        .car-card { transition: transform 0.2s ease, box-shadow 0.2s ease; }
        .hero-gradient { background: linear-gradient(135deg, var(--color-secondary) 0%, var(--color-accent) 50%, #0f0f23 100%); }
        .glass { background: rgba(255,255,255,0.05); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); }
        .bg-brand { background-color: var(--color-primary); }
        .bg-brand\/10 { background-color: color-mix(in srgb, var(--color-primary) 10%, transparent); }
        .bg-brand\/20 { background-color: color-mix(in srgb, var(--color-primary) 20%, transparent); }
        .bg-brand\/50 { background-color: color-mix(in srgb, var(--color-primary) 80%, transparent); }
        .hover\:bg-brand\/10:hover { background-color: color-mix(in srgb, var(--color-primary) 10%, transparent); }
        .hover\:bg-brand\/20:hover { background-color: color-mix(in srgb, var(--color-primary) 20%, transparent); }
        .bg-brand-hover:hover { background-color: var(--color-secondary); }
        .text-brand { color: var(--color-primary); }
        .text-brand-hover:hover { color: var(--color-primary); }
        .border-brand { border-color: var(--color-primary); }
        .ring-brand:focus { --tw-ring-color: var(--color-accent); }
        .bg-brand-light { background-color: color-mix(in srgb, var(--color-primary) 10%, white); }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .text-brand-on-light { color: var(--color-primary); }
    </style>
    {% block extra_head %}{% endblock %}
</head>
<body class="bg-gray-50 font-tajawal text-gray-800 min-h-screen flex flex-col">

    <!-- Navbar -->
    <nav class="bg-white shadow-sm sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <a href="{% url 'home' %}" class="flex items-center gap-2">
                    {% if site_logo %}
                    <img src="{{ site_logo }}" alt="{{ site_name }}" class="h-12 w-auto rounded-full">
                    {% else %}
                    <div class="w-12 h-12 bg-brand rounded-full flex items-center justify-center">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17a2 2 0 11-4 0 2 2 0 014 0zM19 17a2 2 0 11-4 0 2 2 0 014 0z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16V6a1 1 0 00-1-1H4a1 1 0 00-1 1v10m10 0h-4m4 0h4a1 1 0 001-1v-5a1 1 0 00-.3-.7l-4-4A1 1 0 0016 5h-3"/>
                        </svg>
                    </div>
                    {% endif %}
                    <div class="group">
                    <span class="text-sm font-bold text-brand group-hover:text-brand">{{ site_name|default:"Ø³ÙŠØ§Ø±Ø§Øª" }}</span>
                    </div>
                </a>

                <div class="hidden md:flex items-center gap-8">
                    <a href="{% url 'home' %}" class="text-gray-600 text-brand-hover font-medium transition">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
                    <a href="{% url 'car_list' %}" class="text-gray-600 text-brand-hover font-medium transition">Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</a>
                    <a href="{% url 'post_list' %}" class="text-gray-600 text-brand-hover font-medium transition">Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª</a>
                    <a href="{% url 'contact' %}" class="text-gray-600 text-brand-hover font-medium transition">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</a>
                    {% if user.is_authenticated %}
                    <a href="{% url 'wishlist' %}" class="text-gray-600 text-brand-hover font-medium transition relative">
                        Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ù…Ù†ÙŠØ§Øª
                        <span id="wishlist-count" class="absolute -top-1 -right-2 bg-red-500 text-white text-[10px] w-4 h-4 rounded-full flex items-center justify-center font-bold">0</span>
                    </a>
                    <a href="{% url 'my_orders' %}" class="text-gray-600 text-brand-hover font-medium transition">Ø·Ù„Ø¨Ø§ØªÙŠ</a>
                    <a href="{% url 'inbox' %}" class="text-gray-600 text-brand-hover font-medium transition">Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</a>
                    {% if user.is_staff %}
                    <a href="{% url 'site_dashboard' %}" class="inline-flex items-center gap-1.5 bg-brand/10 text-brand text-sm font-bold px-4 py-2 rounded-xl hover:bg-brand/20 transition">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z"/></svg>
                        Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
                    </a>
                    {% endif %}
                    <div class="flex items-center gap-3 border-r border-gray-200 pr-6">
                        <div class="w-8 h-8 bg-brand-light rounded-full flex items-center justify-center text-brand font-bold text-sm">{{ user.username|first|upper }}</div>
                        <span class="text-sm font-medium text-gray-700">{{ user.get_short_name|default:user.username }}</span>
                        <a href="{% url 'logout' %}" class="text-sm text-red-500 hover:text-red-600 font-medium transition">Ø®Ø±ÙˆØ¬</a>
                    </div>
                    {% else %}
                    <div class="flex items-center gap-3 border-r border-gray-200 pr-6">
                        <a href="{% url 'login' %}" class="text-gray-600 text-brand-hover font-medium transition">Ø¯Ø®ÙˆÙ„</a>
                        <a href="{% url 'register' %}" class="bg-brand bg-brand-hover text-white text-sm font-medium px-4 py-2 rounded-xl transition">Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</a>
                    </div>
                    {% endif %}
                </div>

                <!-- Lang & Currency Switcher -->
                <div class="hidden md:flex items-center gap-2 border-r border-gray-200 pr-4 mr-2">
                    <div class="relative" id="lang-dropdown">
                        <button type="button" onclick="document.getElementById('lang-menu').classList.toggle('hidden')" class="flex items-center gap-1 px-2 py-1.5 text-xs font-medium text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition">
                            <span id="lang-flag">ğŸ‡¸ğŸ‡¦</span>
                            <span id="lang-label">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</span>
                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
                        </button>
                        <div id="lang-menu" class="hidden absolute top-full left-0 mt-1 bg-white rounded-xl shadow-lg border border-gray-100 py-1 min-w-[120px] z-50">
                            <button onclick="setLang('ar')" class="w-full text-right px-3 py-2 text-xs hover:bg-gray-50 flex items-center gap-2">ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</button>
                            <button onclick="setLang('en')" class="w-full text-right px-3 py-2 text-xs hover:bg-gray-50 flex items-center gap-2">ğŸ‡¬ğŸ‡§ English</button>
                        </div>
                    </div>
                    <div class="relative" id="currency-dropdown">
                        <button type="button" onclick="document.getElementById('currency-menu').classList.toggle('hidden')" class="flex items-center gap-1 px-2 py-1.5 text-xs font-medium text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition">
                            <span id="currency-label">â‚© KRW</span>
                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
                        </button>
                        <div id="currency-menu" class="hidden absolute top-full left-0 mt-1 bg-white rounded-xl shadow-lg border border-gray-100 py-1 min-w-[120px] z-50">
                            <button onclick="setCurrency('KRW')" class="w-full text-right px-3 py-2 text-xs hover:bg-gray-50">â‚© KRW</button>
                            <button onclick="setCurrency('USD')" class="w-full text-right px-3 py-2 text-xs hover:bg-gray-50">$ USD</button>
                            <button onclick="setCurrency('SAR')" class="w-full text-right px-3 py-2 text-xs hover:bg-gray-50">ï·¼ SAR</button>
                            <button onclick="setCurrency('AED')" class="w-full text-right px-3 py-2 text-xs hover:bg-gray-50">Ø¯.Ø¥ AED</button>
                            <button onclick="setCurrency('EUR')" class="w-full text-right px-3 py-2 text-xs hover:bg-gray-50">â‚¬ EUR</button>
                        </div>
                    </div>
                </div>

                <button id="mobile-menu-btn" class="md:hidden p-2 rounded-lg hover:bg-gray-100">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden bg-white border-t">
            <div class="px-4 py-3 space-y-2">
                <a href="{% url 'home' %}" class="block py-2 px-3 rounded-lg hover:bg-gray-100 font-medium">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
                <a href="{% url 'car_list' %}" class="block py-2 px-3 rounded-lg hover:bg-gray-100 font-medium">Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</a>
                <a href="{% url 'post_list' %}" class="block py-2 px-3 rounded-lg hover:bg-gray-100 font-medium">Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª</a>
                <a href="{% url 'contact' %}" class="block py-2 px-3 rounded-lg hover:bg-gray-100 font-medium">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</a>
                <!-- Mobile Lang/Currency -->
                <div class="flex items-center gap-2 py-2 px-3 border-t border-gray-100 mt-2">
                    <button onclick="cycleLang()" id="mobile-lang-btn" class="flex items-center gap-1 px-3 py-1.5 bg-gray-100 rounded-lg text-xs font-medium">
                        <span id="mobile-lang-flag">ğŸ‡¸ğŸ‡¦</span> <span id="mobile-lang-label">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</span>
                    </button>
                    <button onclick="cycleCurrency()" id="mobile-currency-btn" class="flex items-center gap-1 px-3 py-1.5 bg-gray-100 rounded-lg text-xs font-medium">
                        <span id="mobile-currency-label">â‚© KRW</span>
                    </button>
                </div>
                <div class="border-t border-gray-100 pt-2 mt-2">
                    {% if user.is_authenticated %}
                    <a href="{% url 'wishlist' %}" class="block py-2 px-3 rounded-lg hover:bg-gray-100 font-medium relative">
                        Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ù…Ù†ÙŠØ§Øª
                        <span id="wishlist-count-mobile" class="absolute top-2 right-8 bg-red-500 text-white text-[10px] w-4 h-4 rounded-full flex items-center justify-center font-bold">0</span>
                    </a>
                    <a href="{% url 'my_orders' %}" class="block py-2 px-3 rounded-lg hover:bg-gray-100 font-medium">Ø·Ù„Ø¨Ø§ØªÙŠ</a>
                    <a href="{% url 'inbox' %}" class="block py-2 px-3 rounded-lg hover:bg-gray-100 font-medium">Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</a>
                    {% if user.is_staff %}
                    <a href="{% url 'site_dashboard' %}" class="block py-2 px-3 rounded-lg hover:bg-brand/10 text-brand font-medium">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a>
                    {% endif %}
                    <div class="flex items-center gap-2 py-2 px-3">
                        <div class="w-8 h-8 bg-brand-light rounded-full flex items-center justify-center text-brand font-bold text-sm">{{ user.username|first|upper }}</div>
                        <span class="text-sm font-medium">{{ user.get_short_name|default:user.username }}</span>
                    </div>
                    <a href="{% url 'logout' %}" class="block py-2 px-3 rounded-lg hover:bg-red-50 text-red-500 font-medium">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</a>
                    {% else %}
                    <a href="{% url 'login' %}" class="block py-2 px-3 rounded-lg hover:bg-gray-100 font-medium">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a>
                    <a href="{% url 'register' %}" class="block py-2 px-3 rounded-lg bg-brand text-white font-medium text-center mt-1">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</a>
                    {% endif %}
                </div>
            </div>
        </div>
    </nav>

    <!-- Messages -->
    {% if messages %}
    <div class="max-w-7xl mx-auto px-4 mt-4">
        {% for message in messages %}
        <div class="p-4 rounded-lg mb-2 {% if message.tags == 'success' %}bg-green-100 text-green-800{% elif message.tags == 'error' %}bg-red-100 text-red-800{% else %}bg-blue-100 text-blue-800{% endif %}">
            {{ message }}
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Mobile Floating Action Buttons -->
    <div class="md:hidden fixed bottom-4 left-4 right-4 z-40 flex justify-between items-center pointer-events-none">
        <!-- Left side: Currency & Language -->
        <div class="flex flex-col gap-2 pointer-events-auto">
            <button onclick="showCurrencyLanguageMenu()" class="w-12 h-12 bg-white rounded-full shadow-lg flex items-center justify-center text-brand hover:bg-gray-50 transition-all hover:scale-110">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129"/>
                </svg>
            </button>
        </div>
        
        <!-- Right side: User Actions -->
        <div class="flex flex-col gap-2 pointer-events-auto">
            {% if user.is_authenticated %}
            <!-- Wishlist Button -->
            <button onclick="window.location.href='{% url 'wishlist' %}'" class="w-12 h-12 bg-white rounded-full shadow-lg flex items-center justify-center text-red-500 hover:bg-red-50 transition-all hover:scale-110 relative">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                </svg>
                <span id="wishlist-count-fab" class="absolute -top-1 -right-1 bg-red-500 text-white text-[10px] w-5 h-5 rounded-full flex items-center justify-center font-bold">0</span>
            </button>
            
            <!-- Orders Button -->
            <button onclick="window.location.href='{% url 'my_orders' %}'" class="w-12 h-12 bg-white rounded-full shadow-lg flex items-center justify-center text-brand hover:bg-brand/10 transition-all hover:scale-110 relative">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/>
                </svg>
            </button>
            
            <!-- Account/Profile Button -->
            <button onclick="showAccountMenu()" class="w-12 h-12 bg-white rounded-full shadow-lg flex items-center justify-center text-purple-500 hover:bg-purple-50 transition-all hover:scale-110 relative">
                <div class="w-5 h-5 bg-purple-500 rounded-full flex items-center justify-center text-white text-xs font-bold">{{ user.username|first|upper }}</div>
            </button>
            {% else %}
            <!-- Login/Register Button -->
            <button onclick="showLoginRegisterMenu()" class="w-12 h-12 bg-brand rounded-full shadow-lg flex items-center justify-center text-white hover:bg-brand-hover transition-all hover:scale-110">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                </svg>
            </button>
            {% endif %}
        </div>
    </div>

    <!-- Discovery Tooltips -->
    <div id="discovery-tooltips" class="md:hidden fixed inset-0 z-50 pointer-events-none">
        <!-- Currency/Language Tooltip -->
        <div id="currency-tooltip" class="absolute bottom-20 left-4 bg-gray-900 text-white p-3 rounded-lg text-sm max-w-xs opacity-0 transition-opacity duration-300 pointer-events-none">
            <div class="flex items-center gap-2 mb-1">
                <svg class="w-4 h-4 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                </svg>
                <span class="font-bold">Ø¬Ø¯ÙŠØ¯!</span>
            </div>
            <p>ØªØºÙŠÙŠØ± Ø§Ù„Ø¹Ù…Ù„Ø© ÙˆØ§Ù„Ù„ØºØ©</p>
            <div class="absolute -bottom-2 left-4 w-0 h-0 border-l-8 border-l-transparent border-r-8 border-r-transparent border-t-8 border-t-gray-900"></div>
        </div>

        <!-- Wishlist Tooltip -->
        {% if user.is_authenticated %}
        <div id="wishlist-tooltip" class="absolute bottom-20 right-4 bg-gray-900 text-white p-3 rounded-lg text-sm max-w-xs opacity-0 transition-opacity duration-300 pointer-events-none">
            <div class="flex items-center gap-2 mb-1">
                <svg class="w-4 h-4 text-red-400" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd"/>
                </svg>
                <span class="font-bold">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ù…Ù†ÙŠØ§Øª</span>
            </div>
            <p>Ø§Ø­ÙØ¸ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…ÙØ¶Ù„Ø© Ù„Ø¯ÙŠÙƒ</p>
            <div class="absolute -bottom-2 right-4 w-0 h-0 border-l-8 border-l-transparent border-r-8 border-r-transparent border-t-8 border-t-gray-900"></div>
        </div>

        <!-- Orders Tooltip -->
        <div id="orders-tooltip" class="absolute bottom-32 right-4 bg-gray-900 text-white p-3 rounded-lg text-sm max-w-xs opacity-0 transition-opacity duration-300 pointer-events-none">
            <div class="flex items-center gap-2 mb-1">
                <svg class="w-4 h-4 text-blue-400" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M8 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM15 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0z"/>
                    <path d="M3 4a1 1 0 00-1 1v10a1 1 0 001 1h1.05a2.5 2.5 0 014.9 0H10a1 1 0 001-1V5a1 1 0 00-1-1H3zM14 7a1 1 0 00-1 1v6.05A2.5 2.5 0 0115.95 16H17a1 1 0 001-1v-5a1 1 0 00-.293-.707l-2-2A1 1 0 0015 7h-1z"/>
                </svg>
                <span class="font-bold">Ø·Ù„Ø¨Ø§ØªÙŠ</span>
            </div>
            <p>ØªØªØ¨Ø¹ Ø·Ù„Ø¨Ø§ØªÙƒ ÙˆÙ…Ø¹Ø§Ù…Ù„Ø§ØªÙƒ</p>
            <div class="absolute -bottom-2 right-4 w-0 h-0 border-l-8 border-l-transparent border-r-8 border-r-transparent border-t-8 border-t-gray-900"></div>
        </div>

        <!-- Account Tooltip -->
        <div id="account-tooltip" class="absolute bottom-44 right-4 bg-gray-900 text-white p-3 rounded-lg text-sm max-w-xs opacity-0 transition-opacity duration-300 pointer-events-none">
            <div class="flex items-center gap-2 mb-1">
                <svg class="w-4 h-4 text-purple-400" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
                </svg>
                <span class="font-bold">Ø­Ø³Ø§Ø¨ÙŠ</span>
            </div>
            <p>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ ÙˆØ§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</p>
            <div class="absolute -bottom-2 right-4 w-0 h-0 border-l-8 border-l-transparent border-r-8 border-r-transparent border-t-8 border-t-gray-900"></div>
        </div>
        {% endif %}
    </div>

    <!-- Content -->
    <main class="flex-grow">
        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer class="bg-gray-900 text-gray-300 mt-16">
        <div class="max-w-7xl mx-auto px-4 py-10 sm:py-12">
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">
                <!-- About -->
                <div class="sm:col-span-2 lg:col-span-1">
                    <div class="flex items-center gap-2 mb-4">
                        {% if site_logo %}
                        <img src="{{ site_logo }}" alt="{{ site_name }}" class="h-8 w-auto">
                        {% endif %}
                        <h3 class="text-white text-lg font-bold">{{ site_name|default:"Ø³ÙŠØ§Ø±Ø§Øª" }}</h3>
                    </div>
                    <p class="text-gray-400 text-sm leading-relaxed bilingual" data-lang-ar="{{ site_about|default:footer_text|default:'Ù…Ù†ØµØ© Ù…ØªØ®ØµØµØ© ÙÙŠ Ø¹Ø±Ø¶ ÙˆØ¨ÙŠØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…Ø³ØªÙˆØ±Ø¯Ø© Ø¨Ø£ÙØ¶Ù„ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ÙˆØ£Ø¹Ù„Ù‰ Ø¬ÙˆØ¯Ø©.' }}" data-lang-en="{{ site_about_en|default:footer_text_en|default:'A platform specialized in displaying and selling imported cars at the best prices and highest quality.' }}">{{ site_about|default:footer_text|default:"Ù…Ù†ØµØ© Ù…ØªØ®ØµØµØ© ÙÙŠ Ø¹Ø±Ø¶ ÙˆØ¨ÙŠØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…Ø³ØªÙˆØ±Ø¯Ø© Ø¨Ø£ÙØ¶Ù„ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ÙˆØ£Ø¹Ù„Ù‰ Ø¬ÙˆØ¯Ø©." }}</p>
                    <!-- Social Media -->
                    {% if site_instagram or site_twitter or site_facebook or site_tiktok or site_snapchat or site_youtube %}
                    <div class="flex items-center gap-3 mt-5">
                        {% if site_instagram %}
                        <a href="{{ site_instagram }}" target="_blank" class="w-9 h-9 bg-gray-800 hover:bg-pink-600 rounded-lg flex items-center justify-center transition" title="Ø§Ù†Ø³ØªÙ‚Ø±Ø§Ù…">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zM12 0C8.741 0 8.333.014 7.053.072 2.695.272.273 2.69.073 7.052.014 8.333 0 8.741 0 12c0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98C8.333 23.986 8.741 24 12 24c3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98C15.668.014 15.259 0 12 0zm0 5.838a6.162 6.162 0 100 12.324 6.162 6.162 0 000-12.324zM12 16a4 4 0 110-8 4 4 0 010 8zm6.406-11.845a1.44 1.44 0 100 2.881 1.44 1.44 0 000-2.881z"/></svg>
                        </a>
                        {% endif %}
                        {% if site_twitter %}
                        <a href="{{ site_twitter }}" target="_blank" class="w-9 h-9 bg-gray-800 hover:bg-sky-500 rounded-lg flex items-center justify-center transition" title="ØªÙˆÙŠØªØ±">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
                        </a>
                        {% endif %}
                        {% if site_facebook %}
                        <a href="{{ site_facebook }}" target="_blank" class="w-9 h-9 bg-gray-800 hover:bg-blue-600 rounded-lg flex items-center justify-center transition" title="ÙÙŠØ³Ø¨ÙˆÙƒ">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
                        </a>
                        {% endif %}
                        {% if site_tiktok %}
                        <a href="{{ site_tiktok }}" target="_blank" class="w-9 h-9 bg-gray-800 hover:bg-gray-700 rounded-lg flex items-center justify-center transition" title="ØªÙŠÙƒ ØªÙˆÙƒ">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M12.525.02c1.31-.02 2.61-.01 3.91-.02.08 1.53.63 3.09 1.75 4.17 1.12 1.11 2.7 1.62 4.24 1.79v4.03c-1.44-.05-2.89-.35-4.2-.97-.57-.26-1.1-.59-1.62-.93-.01 2.92.01 5.84-.02 8.75-.08 1.4-.54 2.79-1.35 3.94-1.31 1.92-3.58 3.17-5.91 3.21-1.43.08-2.86-.31-4.08-1.03-2.02-1.19-3.44-3.37-3.65-5.71-.02-.5-.03-1-.01-1.49.18-1.9 1.12-3.72 2.58-4.96 1.66-1.44 3.98-2.13 6.15-1.72.02 1.48-.04 2.96-.04 4.44-.99-.32-2.15-.23-3.02.37-.63.41-1.11 1.04-1.36 1.75-.21.51-.15 1.07-.14 1.61.24 1.64 1.82 3.02 3.5 2.87 1.12-.01 2.19-.66 2.77-1.61.19-.33.4-.67.41-1.06.1-1.79.06-3.57.07-5.36.01-4.03-.01-8.05.02-12.07z"/></svg>
                        </a>
                        {% endif %}
                        {% if site_snapchat %}
                        <a href="{{ site_snapchat }}" target="_blank" class="w-9 h-9 bg-gray-800 hover:bg-yellow-400 rounded-lg flex items-center justify-center transition" title="Ø³Ù†Ø§Ø¨ Ø´Ø§Øª">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M12.017 0C5.396 0 .029 5.367.029 11.987c0 5.079 3.158 9.417 7.618 11.162-.105-.949-.199-2.403.041-3.439.219-.937 1.406-5.957 1.406-5.957s-.359-.72-.359-1.781c0-1.668.967-2.914 2.171-2.914 1.023 0 1.518.769 1.518 1.69 0 1.029-.655 2.568-.994 3.995-.283 1.194.599 2.169 1.777 2.169 2.133 0 3.772-2.249 3.772-5.495 0-2.873-2.064-4.882-5.012-4.882-3.414 0-5.418 2.561-5.418 5.207 0 1.031.397 2.138.893 2.738a.36.36 0 01.083.345l-.333 1.36c-.053.22-.174.267-.402.161-1.499-.698-2.436-2.889-2.436-4.649 0-3.785 2.75-7.262 7.929-7.262 4.163 0 7.398 2.967 7.398 6.931 0 4.136-2.607 7.464-6.227 7.464-1.216 0-2.359-.631-2.75-1.378l-.748 2.853c-.271 1.043-1.002 2.35-1.492 3.146C9.57 23.812 10.763 24 12.017 24c6.624 0 11.99-5.367 11.99-11.988C24.007 5.367 18.641 0 12.017 0z"/></svg>
                        </a>
                        {% endif %}
                        {% if site_youtube %}
                        <a href="{{ site_youtube }}" target="_blank" class="w-9 h-9 bg-gray-800 hover:bg-red-600 rounded-lg flex items-center justify-center transition" title="ÙŠÙˆØªÙŠÙˆØ¨">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M23.498 6.186a3.016 3.016 0 00-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 00.502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 002.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 002.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/></svg>
                        </a>
                        {% endif %}
                    </div>
                    {% endif %}
                </div>

                <!-- Quick Links -->
                <div>
                    <h3 class="text-white text-lg font-bold mb-4">Ø±ÙˆØ§Ø¨Ø· Ø³Ø±ÙŠØ¹Ø©</h3>
                    <ul class="space-y-2 text-sm">
                        <li><a href="{% url 'home' %}" class="hover:text-white transition">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
                        <li><a href="{% url 'car_list' %}" class="hover:text-white transition">Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</a></li>
                        <li><a href="{% url 'car_request' %}" class="hover:text-white transition">Ø·Ù„Ø¨ Ø³ÙŠØ§Ø±Ø©</a></li>
                        <li><a href="{% url 'contact' %}" class="hover:text-white transition">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</a></li>
                    </ul>
                </div>

                <!-- Contact Info -->
                <div>
                    <h3 class="text-white text-lg font-bold mb-4">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</h3>
                    <ul class="space-y-3 text-sm">
                        {% if site_phone %}
                        <li class="flex items-center gap-2">
                            <svg class="w-4 h-4 text-gray-500 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/></svg>
                            <a href="tel:{{ site_phone }}" class="hover:text-white transition" dir="ltr">{{ site_phone }}</a>
                        </li>
                        {% endif %}
                        {% if site_phone2 %}
                        <li class="flex items-center gap-2">
                            <svg class="w-4 h-4 text-gray-500 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/></svg>
                            <a href="tel:{{ site_phone2 }}" class="hover:text-white transition" dir="ltr">{{ site_phone2 }}</a>
                        </li>
                        {% endif %}
                        {% if site_whatsapp %}
                        <li class="flex items-center gap-2">
                            <svg class="w-4 h-4 text-green-500 shrink-0" fill="currentColor" viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>
                            <a href="https://wa.me/{{ site_whatsapp|format_whatsapp_number }}" target="_blank" class="hover:text-white transition" dir="ltr">{{ site_whatsapp }}</a>
                        </li>
                        {% endif %}
                        {% if site_email %}
                        <li class="flex items-center gap-2">
                            <svg class="w-4 h-4 text-gray-500 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>
                            <a href="mailto:{{ site_email }}" class="hover:text-white transition">{{ site_email }}</a>
                        </li>
                        {% endif %}
                        {% if site_address %}
                        <li class="flex items-start gap-2">
                            <svg class="w-4 h-4 text-gray-500 shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
                            {% if site_map_url %}<a href="{{ site_map_url }}" target="_blank" class="hover:text-white transition bilingual" data-lang-ar="{{ site_address }}{% if site_city %} - {{ site_city }}{% endif %}" data-lang-en="{{ site_address_en|default:site_address }}{% if site_city_en or site_city %} - {{ site_city_en|default:site_city }}{% endif %}">{{ site_address }}{% if site_city %} - {{ site_city }}{% endif %}</a>{% else %}<span class="bilingual" data-lang-ar="{{ site_address }}{% if site_city %} - {{ site_city }}{% endif %}" data-lang-en="{{ site_address_en|default:site_address }}{% if site_city_en or site_city %} - {{ site_city_en|default:site_city }}{% endif %}">{{ site_address }}{% if site_city %} - {{ site_city }}{% endif %}</span>{% endif %}
                        </li>
                        {% endif %}
                        {% if site_working_hours %}
                        <li class="flex items-center gap-2">
                            <svg class="w-4 h-4 text-gray-500 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                            <span class="bilingual" data-lang-ar="{{ site_working_hours }}" data-lang-en="{{ site_working_hours_en|default:site_working_hours }}">{{ site_working_hours }}</span>
                        </li>
                        {% endif %}
                        {% if not site_phone and not site_whatsapp and not site_email and not site_address %}
                        <li class="text-gray-400">Ù„Ù„Ø§Ø³ØªÙØ³Ø§Ø±Ø§Øª ÙˆØ§Ù„Ø·Ù„Ø¨Ø§Øª</li>
                        {% endif %}
                    </ul>
                </div>

                <!-- WhatsApp CTA -->
                {% if site_whatsapp %}
                <div>
                    <h3 class="text-white text-lg font-bold mb-4">ØªÙˆØ§ØµÙ„ Ø³Ø±ÙŠØ¹</h3>
                    <a href="https://wa.me/{{ site_whatsapp|format_whatsapp_number }}?text={{ 'Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ Ø£ÙˆØ¯ Ø§Ù„Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ù† Ø®Ø¯Ù…Ø§ØªÙƒÙ…'|whatsapp_encode_text }}" target="_blank" class="inline-flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white font-medium px-5 py-3 rounded-xl transition text-sm">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>
                        Ø±Ø§Ø³Ù„Ù†Ø§ ÙˆØ§ØªØ³Ø§Ø¨
                    </a>
                    {% if site_working_hours %}
                    <p class="text-gray-500 text-xs mt-2 bilingual" data-lang-ar="{{ site_working_hours }}" data-lang-en="{{ site_working_hours_en|default:site_working_hours }}">{{ site_working_hours }}</p>
                    {% endif %}
                </div>
                {% endif %}
            </div>
            <div class="border-t border-gray-800 mt-8 pt-8 text-center text-sm text-gray-500">
                &copy; {% now "Y" %} {{ site_name|default:"Ø³ÙŠØ§Ø±Ø§Øª" }}. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.
            </div>
        </div>
    </footer>

    <script>
        document.getElementById('mobile-menu-btn').addEventListener('click', function() {
            document.getElementById('mobile-menu').classList.toggle('hidden');
        });

        // Close dropdowns on outside click
        document.addEventListener('click', function(e) {
            if (!document.getElementById('lang-dropdown')?.contains(e.target)) {
                document.getElementById('lang-menu')?.classList.add('hidden');
            }
            if (!document.getElementById('currency-dropdown')?.contains(e.target)) {
                document.getElementById('currency-menu')?.classList.add('hidden');
            }
        });

        // â•â•â•â•â•â•â•â•â•â•â• LANGUAGE SYSTEM â•â•â•â•â•â•â•â•â•â•â•
        const LANGS = {
            ar: { flag: 'ğŸ‡¸ğŸ‡¦', label: 'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©', dir: 'rtl', font: "'Tajawal', sans-serif" },
            en: { flag: 'ğŸ‡¬ğŸ‡§', label: 'English', dir: 'ltr', font: "'Inter', 'Tajawal', sans-serif" },
        };
        const LANG_ORDER = ['ar', 'en'];

        const TRANSLATIONS = {
            // Navbar
            'Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©':        'Home',
            'Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª':        'Cars',
            'Ø³ÙŠØ§Ø±Ø§ØªÙ†Ø§':        'Our Cars',
            'Ø§Ù„Ù…Ø¨Ø§Ø¹Ø©':         'Sold',
            'Ø·Ù„Ø¨ Ø³ÙŠØ§Ø±Ø©':       'Request Car',
            'ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§':      'Contact Us',
            'Ø·Ù„Ø¨Ø§ØªÙŠ':          'My Orders',
            'Ø§Ù„Ø±Ø³Ø§Ø¦Ù„':         'Messages',
            'Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…':     'Dashboard',
            'Ø®Ø±ÙˆØ¬':            'Logout',
            'Ø¯Ø®ÙˆÙ„':            'Login',
            'Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯':       'Register',
            'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„':    'Login',
            'Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨':      'Create Account',
            'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬':    'Logout',
            'Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø¹Ø©': 'Sold Cars',
            // Home
            'Ø§Ø¹Ø«Ø± Ø¹Ù„Ù‰ Ø³ÙŠØ§Ø±Ø© Ø£Ø­Ù„Ø§Ù…Ùƒ': 'Find Your Dream Car',
            'ØªØµÙØ­ Ø¢Ù„Ø§Ù Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…Ø³ØªÙˆØ±Ø¯Ø© Ø¨Ø£ÙØ¶Ù„ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ÙˆØ§Ù„Ø¬ÙˆØ¯Ø©': 'Browse thousands of imported cars at the best prices and quality',
            'Ø¨Ø­Ø«':             'Search',
            'Ø§Ù„Ø´Ø±ÙƒØ© Ø§Ù„Ù…ØµÙ†Ø¹Ø©':  'Manufacturer',
            'Ø³Ù†Ø© Ø§Ù„ØµÙ†Ø¹':       'Year',
            'Ø³ÙŠØ§Ø±Ø© Ù…ØªØ§Ø­Ø©':     'Available Cars',
            'Ø´Ø±ÙƒØ© Ù…ØµÙ†Ø¹Ø©':      'Manufacturers',
            'Ù…ÙˆØ¯ÙŠÙ„':           'Models',
            'Ø¯Ø¹Ù… Ù…ØªÙˆØ§ØµÙ„':      '24/7 Support',
            'Ø£Ø­Ø¯Ø« Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª':   'Latest Cars',
            'Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„':        'View All',
            'Ø§Ù„Ø´Ø±ÙƒØ§Øª Ø§Ù„Ù…ØµÙ†Ø¹Ø©': 'Manufacturers',
            'Ù„Ù… ØªØ¬Ø¯ Ø³ÙŠØ§Ø±ØªÙƒ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©ØŸ': "Didn't find your car?",
            'Ø£Ø±Ø³Ù„ Ù„Ù†Ø§ Ø·Ù„Ø¨Ùƒ ÙˆØ³Ù†Ø¨Ø­Ø« Ù„Ùƒ Ø¹Ù† Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ø¨Ø£ÙØ¶Ù„ Ø³Ø¹Ø±': 'Send us your request and we will find the right car at the best price',
            'Ø§Ø·Ù„Ø¨ Ø³ÙŠØ§Ø±Ø© Ø§Ù„Ø¢Ù†': 'Request a Car Now',
            // Car list
            'Ø§Ù„ÙƒÙ„':            'All',
            'Ø³ÙŠØ§Ø±Ø§Øª':          'Cars',
            'Ù…Ø²Ø§Ø¯Ø§Øª':          'Auctions',
            'Ù†ØªÙŠØ¬Ø©':           'results',
            'ÙÙ„Ø§ØªØ± Ù…ØªÙ‚Ø¯Ù…Ø©':    'Advanced Filters',
            'ØªØ±ØªÙŠØ¨:':          'Sort:',
            'Ø§Ù„Ø£Ø­Ø¯Ø«':          'Newest',
            'Ø§Ù„Ø£Ø±Ø®Øµ':          'Cheapest',
            'Ø§Ù„Ø£ØºÙ„Ù‰':          'Most Expensive',
            'Ø§Ù„Ø£Ø­Ø¯Ø« ØµÙ†Ø¹Ø§Ù‹':    'Newest Make',
            'Ø£Ù‚Ù„ Ù…Ø³Ø§ÙØ©':       'Lowest Mileage',
            'Ø£ÙƒØ«Ø± Ù…Ø³Ø§ÙØ©':      'Highest Mileage',
            'ØªÙ… Ø§Ù„Ø¨ÙŠØ¹':        'Sold',
            'ÙƒÙ…':              'km',
            'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬':   'No Results',
            'Ø¬Ø±Ù‘Ø¨ ØªØºÙŠÙŠØ± Ø§Ù„ÙÙ„Ø§ØªØ± Ø£Ùˆ Ø§Ù„Ø¨Ø­Ø« Ø¨ÙƒÙ„Ù…Ø§Øª Ù…Ø®ØªÙ„ÙØ©': 'Try changing filters or search with different keywords',
            'Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª': 'Show All Cars',
            'Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„':        'Clear All',
            'Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙÙ„Ø§ØªØ±': 'Clear All Filters',
            'ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„Ø§ØªØ±':   'Apply Filters',
            'Ù…ØªØ§Ø­':            'Available',
            'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±':    'Pending',
            'Ù…Ù†ØªÙ‡ÙŠ':           'Expired',
            // Car detail
            'Ø§Ù„Ù…ÙˆØ§ØµÙØ§Øª':       'Specifications',
            'Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„':         'Model',
            'Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„Ù…Ù‚Ø·ÙˆØ¹Ø©': 'Mileage',
            'Ø§Ù„Ù…Ø³Ø§ÙØ©':         'Mileage',
            'Ù†Ø§Ù‚Ù„ Ø§Ù„Ø­Ø±ÙƒØ©':     'Transmission',
            'Ø§Ù„ÙˆÙ‚ÙˆØ¯':          'Fuel',
            'Ø§Ù„Ù„ÙˆÙ†':           'Color',
            'Ù„ÙˆÙ† Ø§Ù„Ù…Ù‚Ø§Ø¹Ø¯':     'Seat Color',
            'Ù†ÙˆØ¹ Ø§Ù„Ù‡ÙŠÙƒÙ„':      'Body Type',
            'Ø§Ù„Ù‚ÙˆØ©':           'Power',
            'Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯ÙØ¹':      'Drive',
            'Ø§Ù„Ù…Ø­Ø±Ùƒ':          'Engine',
            'Ø±Ù‚Ù… Ø§Ù„Ù‡ÙŠÙƒÙ„':      'VIN',
            'Ø§Ù„Ù…ÙˆÙ‚Ø¹':          'Location',
            'Ø§Ù„Ø³Ø¹Ø±':           'Price',
            'Ø§Ø·Ù„Ø¨ Ù‡Ø°Ù‡ Ø§Ù„Ø³ÙŠØ§Ø±Ø©': 'Order This Car',
            'Ø§Ø³ØªÙØ³Ø§Ø±':         'Inquiry',
            'Ø±Ù‚Ù… Ø§Ù„Ù‚Ø·Ø¹Ø©:':     'Lot #:',
            'ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙØ­Øµ':     'Inspection Report',
            'Ø§Ù„ÙˆØµÙ':           'Description',
            'Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª':        'Features',
            'Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª':       'Reviews',
            // Footer
            'Ø±ÙˆØ§Ø¨Ø· Ø³Ø±ÙŠØ¹Ø©':     'Quick Links',
            'ØªÙˆØ§ØµÙ„ Ø³Ø±ÙŠØ¹':      'Quick Contact',
            'Ø±Ø§Ø³Ù„Ù†Ø§ ÙˆØ§ØªØ³Ø§Ø¨':   'WhatsApp Us',
            'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.': 'All rights reserved.',
            // Filters
            'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø´Ø±ÙƒØ§Øª':    'All Manufacturers',
            'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„Ø§Øª':  'All Models',
            'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ù†ÙˆØ§Øª':    'All Years',
            'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù„ÙˆØ§Ù†':    'All Colors',
            'Ø§Ù„Ø³Ø¹Ø± Ù…Ù†':        'Price From',
            'Ø§Ù„Ø³Ø¹Ø± Ø¥Ù„Ù‰':       'Price To',
            'Ø§Ù„Ù…Ø³Ø§ÙØ© Ù…Ù†':      'Mileage From',
            'Ø§Ù„Ù…Ø³Ø§ÙØ© Ø¥Ù„Ù‰':     'Mileage To',
            'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³ÙŠØ§Ø±Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹': 'No cars available',
            'Ù…Ù…ÙŠØ²Ø©':           'Featured',
            // Expired auctions
            'Ù…Ø²Ø§Ø¯Ø§Øª Ù…Ù†ØªÙ‡ÙŠØ©':   'Expired Auctions',
            'Ø§Ù„Ù…Ø²Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©': 'Active Auctions',
            // Forms
            'Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„':    'Full Name',
            'Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„':      'Phone Number',
            'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ': 'Email',
            'Ø§Ù„Ø±Ø³Ø§Ù„Ø©':         'Message',
            'Ø¥Ø±Ø³Ø§Ù„':           'Send',
            'Ù„Ù„Ø§Ø³ØªÙØ³Ø§Ø±Ø§Øª ÙˆØ§Ù„Ø·Ù„Ø¨Ø§Øª': 'For inquiries and orders',
        };

        function t(text) {
            return TRANSLATIONS[text] || text;
        }

        function setLang(lang) {
            localStorage.setItem('site_lang', lang);
            applyLang(lang);
            document.getElementById('lang-menu')?.classList.add('hidden');
        }

        function cycleLang() {
            const cur = localStorage.getItem('site_lang') || 'ar';
            const idx = (LANG_ORDER.indexOf(cur) + 1) % LANG_ORDER.length;
            setLang(LANG_ORDER[idx]);
        }

        function applyLang(lang) {
            const cfg = LANGS[lang];
            const root = document.getElementById('html-root');
            root.setAttribute('lang', lang);
            root.setAttribute('dir', cfg.dir);
            document.body.style.fontFamily = cfg.font;

            // Update switcher labels
            const setEl = (id, val) => { const el = document.getElementById(id); if (el) el.textContent = val; };
            setEl('lang-flag', cfg.flag);
            setEl('lang-label', cfg.label);
            setEl('mobile-lang-flag', cfg.flag);
            setEl('mobile-lang-label', cfg.label);

            // Handle bilingual elements (data-lang-ar / data-lang-en)
            document.querySelectorAll('.bilingual').forEach(el => {
                const val = el.getAttribute('data-lang-' + lang);
                if (val) el.textContent = val;
            });

            // Translate all text nodes via dictionary
            if (lang === 'en') {
                document.querySelectorAll('a, span, button, h1, h2, h3, p, div, label, li, option, td, th').forEach(el => {
                    if (el.classList.contains('bilingual')) return;
                    el.childNodes.forEach(node => {
                        if (node.nodeType === 3) {
                            const orig = node._origText || node.textContent.trim();
                            if (!node._origText && orig) node._origText = orig;
                            if (orig) {
                                const translated = t(orig);
                                if (translated !== orig) node.textContent = node.textContent.replace(orig, translated);
                            }
                        }
                    });
                });
            } else {
                // Restore Arabic originals
                document.querySelectorAll('.bilingual').forEach(el => {
                    const val = el.getAttribute('data-lang-ar');
                    if (val) el.textContent = val;
                });
                document.querySelectorAll('a, span, button, h1, h2, h3, p, div, label, li, option, td, th').forEach(el => {
                    if (el.classList.contains('bilingual')) return;
                    el.childNodes.forEach(node => {
                        if (node.nodeType === 3 && node._origText) {
                            node.textContent = node.textContent.replace(node.textContent.trim(), node._origText);
                        }
                    });
                });
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â• CURRENCY SYSTEM â•â•â•â•â•â•â•â•â•â•â•
        const CURRENCIES = {
            KRW: { symbol: 'â‚©', label: 'â‚© KRW', rate: 1 },
            USD: { symbol: '$', label: '$ USD', rate: 0.00074 },
            SAR: { symbol: 'ï·¼', label: 'ï·¼ SAR', rate: 0.00278 },
            AED: { symbol: 'Ø¯.Ø¥', label: 'Ø¯.Ø¥ AED', rate: 0.00272 },
            EUR: { symbol: 'â‚¬', label: 'â‚¬ EUR', rate: 0.00069 },
        };
        const CURRENCY_ORDER = ['KRW', 'USD', 'SAR', 'AED', 'EUR'];

        function setCurrency(code) {
            localStorage.setItem('site_currency', code);
            applyCurrency(code);
            document.getElementById('currency-menu')?.classList.add('hidden');
        }

        function cycleCurrency() {
            const cur = localStorage.getItem('site_currency') || 'KRW';
            const idx = (CURRENCY_ORDER.indexOf(cur) + 1) % CURRENCY_ORDER.length;
            setCurrency(CURRENCY_ORDER[idx]);
        }

        function applyCurrency(code) {
            const cfg = CURRENCIES[code];
            const setEl = (id, val) => { const el = document.getElementById(id); if (el) el.textContent = val; };
            setEl('currency-label', cfg.label);
            setEl('mobile-currency-label', cfg.label);

            // Convert all prices: find elements with data-price-krw or price patterns
            document.querySelectorAll('[data-price-krw]').forEach(el => {
                const krw = parseFloat(el.getAttribute('data-price-krw'));
                if (isNaN(krw)) return;
                const converted = code === 'KRW' ? krw : Math.round(krw * cfg.rate);
                el.innerHTML = converted.toLocaleString() + ' <span class="text-[9px] sm:text-xs font-medium">' + cfg.symbol + '</span>';
            });
        }

        // â•â•â•â•â•â•â•â•â•â•â• INIT ON LOAD â•â•â•â•â•â•â•â•â•â•â•
        document.addEventListener('DOMContentLoaded', function() {
            const lang = localStorage.getItem('site_lang') || 'ar';
            const currency = localStorage.getItem('site_currency') || 'KRW';
            if (lang !== 'ar') applyLang(lang);
            else {
                const cfg = LANGS[lang];
                const setEl = (id, val) => { const el = document.getElementById(id); if (el) el.textContent = val; };
                setEl('lang-flag', cfg.flag);
                setEl('lang-label', cfg.label);
                setEl('mobile-lang-flag', cfg.flag);
                setEl('mobile-lang-label', cfg.label);
            }
            if (currency !== 'KRW') applyCurrency(currency);
            else {
                const setEl = (id, val) => { const el = document.getElementById(id); if (el) el.textContent = val; };
                setEl('currency-label', CURRENCIES.KRW.label);
                setEl('mobile-currency-label', CURRENCIES.KRW.label);
            }
        });

        // Wishlist count functionality
        function updateWishlistCount() {
            {% if user.is_authenticated %}
            fetch('/wishlist/count/')
                .then(response => response.json())
                .then(data => {
                    const desktopCount = document.getElementById('wishlist-count');
                    const mobileCount = document.getElementById('wishlist-count-mobile');
                    
                    if (desktopCount) {
                        desktopCount.textContent = data.count;
                        desktopCount.style.display = data.count > 0 ? 'flex' : 'none';
                    }
                    if (mobileCount) {
                        mobileCount.textContent = data.count;
                        mobileCount.style.display = data.count > 0 ? 'flex' : 'none';
                    }
                })
                .catch(error => console.error('Error fetching wishlist count:', error));
            {% endif %}
        }

        // Update wishlist count on page load
        document.addEventListener('DOMContentLoaded', updateWishlistCount);

        // Update wishlist count after wishlist toggle
        window.updateWishlistCount = updateWishlistCount;

        // â•â•â•â•â•â•â•â•â•â•â• MOBILE FLOATING ACTION BUTTONS â•â•â•â•â•â•â•â•â•â•â•
        
        // Discovery tooltips system
        let discoveryTimeouts = {};
        let hasShownTooltips = {};
        
        function showTooltip(tooltipId) {
            const tooltip = document.getElementById(tooltipId);
            if (!tooltip || hasShownTooltips[tooltipId]) return;
            
            clearTimeout(discoveryTimeouts[tooltipId]);
            tooltip.style.opacity = '1';
            
            // Auto hide after 4 seconds
            discoveryTimeouts[tooltipId] = setTimeout(() => {
                tooltip.style.opacity = '0';
                hasShownTooltips[tooltipId] = true;
            }, 4000);
        }
        
        function hideTooltip(tooltipId) {
            const tooltip = document.getElementById(tooltipId);
            if (!tooltip) return;
            
            clearTimeout(discoveryTimeouts[tooltipId]);
            tooltip.style.opacity = '0';
        }
        
        // Show tooltips on first page load
        function initializeDiscoveryTooltips() {
            // Only show on mobile and not on first visit
            if (window.innerWidth >= 768) return;
            
            // Check if user has seen tooltips before
            const hasSeenTooltips = localStorage.getItem('has_seen_discovery_tooltips');
            if (hasSeenTooltips) return;
            
            // Show currency tooltip after 2 seconds
            setTimeout(() => showTooltip('currency-tooltip'), 2000);
            
            // Show wishlist tooltip after 3.5 seconds (if authenticated)
            {% if user.is_authenticated %}
            setTimeout(() => showTooltip('wishlist-tooltip'), 3500);
            setTimeout(() => showTooltip('orders-tooltip'), 5000);
            setTimeout(() => showTooltip('account-tooltip'), 6500);
            {% else %}
            // Show login tooltip after 3.5 seconds (if not authenticated)
            setTimeout(() => {
                const loginBtn = document.querySelector('[onclick="showLoginRegisterMenu()"]');
                if (loginBtn) {
                    loginBtn.classList.add('animate-pulse');
                    setTimeout(() => loginBtn.classList.remove('animate-pulse'), 2000);
                }
            }, 3500);
            {% endif %}
            
            // Mark tooltips as shown
            setTimeout(() => {
                localStorage.setItem('has_seen_discovery_tooltips', 'true');
            }, 8000);
        }
        
        // Currency/Language menu for mobile
        function showCurrencyLanguageMenu() {
            // Create a simple modal for currency/language selection
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-xl p-6 max-w-sm w-full">
                    <h3 class="text-lg font-bold mb-4 text-gray-900">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h3>
                    
                    <div class="mb-6">
                        <h4 class="text-sm font-medium text-gray-700 mb-2">Ø§Ù„Ù„ØºØ©</h4>
                        <div class="flex gap-2">
                            <button onclick="setLanguage('ar'); this.parentElement.parentElement.parentElement.remove();" class="flex-1 py-2 px-3 bg-brand text-white rounded-lg text-sm">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</button>
                            <button onclick="setLanguage('en'); this.parentElement.parentElement.parentElement.remove();" class="flex-1 py-2 px-3 bg-gray-200 text-gray-700 rounded-lg text-sm">English</button>
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <h4 class="text-sm font-medium text-gray-700 mb-2">Ø§Ù„Ø¹Ù…Ù„Ø©</h4>
                        <div class="grid grid-cols-2 gap-2">
                            <button onclick="setCurrency('KRW'); this.parentElement.parentElement.parentElement.remove();" class="py-2 px-3 bg-gray-100 rounded-lg text-sm">â‚© KRW</button>
                            <button onclick="setCurrency('USD'); this.parentElement.parentElement.parentElement.remove();" class="py-2 px-3 bg-gray-100 rounded-lg text-sm">$ USD</button>
                            <button onclick="setCurrency('SAR'); this.parentElement.parentElement.parentElement.remove();" class="py-2 px-3 bg-gray-100 rounded-lg text-sm">ï·¼ SAR</button>
                            <button onclick="setCurrency('AED'); this.parentElement.parentElement.parentElement.remove();" class="py-2 px-3 bg-gray-100 rounded-lg text-sm">Ø¯.Ø¥ AED</button>
                        </div>
                    </div>
                    
                    <button onclick="this.parentElement.parentElement.remove()" class="w-full py-2 bg-gray-200 text-gray-700 rounded-lg text-sm">Ø¥ØºÙ„Ø§Ù‚</button>
                </div>
            `;
            document.body.appendChild(modal);
            
            // Close on backdrop click
            modal.addEventListener('click', (e) => {
                if (e.target === modal) modal.remove();
            });
        }
        
        // Login/Register menu for mobile
        function showLoginRegisterMenu() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-xl p-6 max-w-sm w-full">
                    <h3 class="text-lg font-bold mb-4 text-gray-900">Ù…Ø±Ø­Ø¨Ø§Ù‹!</h3>
                    <p class="text-gray-600 mb-6 text-sm">Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ø£Ùˆ Ø£Ù†Ø´Ø¦ Ø­Ø³Ø§Ø¨Ø§Ù‹ Ø¬Ø¯ÙŠØ¯Ø§Ù‹ Ù„Ù„Ø§Ø³ØªÙØ§Ø¯Ø© Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙŠØ²Ø§Øª</p>
                    
                    <div class="space-y-3">
                        <a href="{% url 'login' %}" class="block w-full py-3 bg-brand text-white rounded-lg text-center font-medium hover:bg-brand-hover transition">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a>
                        <a href="{% url 'register' %}" class="block w-full py-3 bg-gray-200 text-gray-700 rounded-lg text-center font-medium hover:bg-gray-300 transition">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</a>
                    </div>
                    
                    <button onclick="this.parentElement.parentElement.remove()" class="w-full mt-4 py-2 text-gray-500 text-sm">Ø¥Ù„ØºØ§Ø¡</button>
                </div>
            `;
            document.body.appendChild(modal);
            
            // Close on backdrop click
            modal.addEventListener('click', (e) => {
                if (e.target === modal) modal.remove();
            });
        }
        
        // Account menu for mobile
        function showAccountMenu() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-xl p-6 max-w-sm w-full">
                    <div class="flex items-center gap-3 mb-6">
                        <div class="w-12 h-12 bg-purple-500 rounded-full flex items-center justify-center text-white font-bold text-lg">{{ user.username|first|upper }}</div>
                        <div>
                            <h3 class="text-lg font-bold text-gray-900">{{ user.get_short_name|default:user.username }}</h3>
                            <p class="text-sm text-gray-500">{{ user.email }}</p>
                        </div>
                    </div>
                    
                    <div class="space-y-2">
                                                
                        <a href="{% url 'wishlist' %}" class="block w-full py-3 px-4 bg-gray-100 text-gray-700 rounded-lg text-right hover:bg-gray-200 transition">
                            <div class="flex items-center justify-between">
                                <span>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ù…Ù†ÙŠØ§Øª</span>
                                <svg class="w-4 h-4 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                                </svg>
                            </div>
                        </a>
                        
                        <a href="{% url 'my_orders' %}" class="block w-full py-3 px-4 bg-gray-100 text-gray-700 rounded-lg text-right hover:bg-gray-200 transition">
                            <div class="flex items-center justify-between">
                                <span>Ø·Ù„Ø¨Ø§ØªÙŠ</span>
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/>
                                </svg>
                            </div>
                        </a>
                        
                        <a href="{% url 'inbox' %}" class="block w-full py-3 px-4 bg-gray-100 text-gray-700 rounded-lg text-right hover:bg-gray-200 transition">
                            <div class="flex items-center justify-between">
                                <span>Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</span>
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                                </svg>
                            </div>
                        </a>
                        
                        {% if user.is_staff %}
                        <a href="{% url 'site_dashboard' %}" class="block w-full py-3 px-4 bg-brand/10 text-brand rounded-lg text-right hover:bg-brand/20 transition">
                            <div class="flex items-center justify-between">
                                <span>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</span>
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z"/>
                                </svg>
                            </div>
                        </a>
                        {% endif %}
                        
                        <div class="border-t pt-2 mt-2">
                            <a href="{% url 'logout' %}" class="block w-full py-3 px-4 bg-red-50 text-red-500 rounded-lg text-right hover:bg-red-100 transition">
                                <div class="flex items-center justify-between">
                                    <span>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</span>
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
                                    </svg>
                                </div>
                            </a>
                        </div>
                    </div>
                    
                    <button onclick="this.parentElement.parentElement.remove()" class="w-full mt-4 py-2 text-gray-500 text-sm">Ø¥Ù„ØºØ§Ø¡</button>
                </div>
            `;
            document.body.appendChild(modal);
            
            // Close on backdrop click
            modal.addEventListener('click', (e) => {
                if (e.target === modal) modal.remove();
            });
        }
        
        // Update wishlist count for FAB
        function updateWishlistCountFAB() {
            {% if user.is_authenticated %}
            fetch('/wishlist/count/')
                .then(response => response.json())
                .then(data => {
                    const fabCount = document.getElementById('wishlist-count-fab');
                    if (fabCount) {
                        fabCount.textContent = data.count;
                        fabCount.style.display = data.count > 0 ? 'flex' : 'none';
                    }
                })
                .catch(error => console.error('Error fetching wishlist count:', error));
            {% endif %}
        }
        
        // First-time user gesture hints
        function addGestureHints() {
            if (window.innerWidth >= 768) return;
            
            // Add subtle bounce animation to FABs on first load
            const fabs = document.querySelectorAll('.md\\:hidden .pointer-events-auto button');
            fabs.forEach((fab, index) => {
                setTimeout(() => {
                    fab.style.animation = 'bounce 1s ease-in-out';
                    setTimeout(() => {
                        fab.style.animation = '';
                    }, 1000);
                }, index * 200);
            });
        }
        
        // Add CSS animation keyframes
        const style = document.createElement('style');
        style.textContent = `
            @keyframes bounce {
                0%, 20%, 53%, 80%, 100% { transform: translateY(0) scale(1); }
                40%, 43% { transform: translateY(-8px) scale(1.05); }
                70% { transform: translateY(-4px) scale(1.02); }
                90% { transform: translateY(-2px) scale(1.01); }
            }
        `;
        document.head.appendChild(style);
        
        // Initialize discovery tooltips on page load
        document.addEventListener('DOMContentLoaded', () => {
            initializeDiscoveryTooltips();
            updateWishlistCountFAB();
            
            // Add gesture hints for first-time visitors
            const hasVisitedBefore = localStorage.getItem('has_visited_before');
            if (!hasVisitedBefore) {
                setTimeout(addGestureHints, 1000);
                localStorage.setItem('has_visited_before', 'true');
            }
        });
        
        // Update FAB count when wishlist changes
        const originalUpdateWishlistCount = window.updateWishlistCount;
        window.updateWishlistCount = function() {
            originalUpdateWishlistCount();
            updateWishlistCountFAB();
        };
    </script>
    
    <!-- Lazy Loading for Manufacturer Logos -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Lazy loading for manufacturer logos
            const lazyImages = document.querySelectorAll('img.lazy-load');
            
            if ('IntersectionObserver' in window) {
                const imageObserver = new IntersectionObserver((entries, observer) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            const img = entry.target;
                            img.src = img.src; // Trigger load
                            img.classList.remove('lazy-load');
                            observer.unobserve(img);
                        }
                    });
                });
                
                lazyImages.forEach(img => {
                    imageObserver.observe(img);
                });
            } else {
                // Fallback for older browsers
                lazyImages.forEach(img => {
                    img.src = img.src;
                    img.classList.remove('lazy-load');
                });
            }
        });
    </script>
    {% block extra_js %}{% endblock %}
</body>
</html>
